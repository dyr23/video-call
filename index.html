<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>手机异地视频</title>
    <style>
        body { margin: 0; background: #000; color: white; font-family: sans-serif; overflow: hidden; }
        
        /* 远程画面全屏显示 */
        #remote-video {
            position: absolute;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            object-fit: cover;
            background: #222;
        }

        /* 本地画面悬浮在右上角 */
        #local-video {
            position: absolute;
            top: 20px; right: 20px;
            width: 120px; height: 160px;
            border-radius: 8px;
            object-fit: cover;
            z-index: 10;
            border: 2px solid rgba(255,255,255,0.3);
            background: #444;
        }

        /* 底部控制栏 */
        .controls {
            position: absolute;
            bottom: 30px; left: 0; right: 0;
            display: flex; flex-direction: column;
            align-items: center; gap: 15px;
            z-index: 20;
            padding: 0 20px;
        }

        .id-box {
            background: rgba(0,0,0,0.6);
            padding: 10px; border-radius: 10px;
            font-size: 14px; text-align: center;
        }

        .input-group { display: flex; width: 100%; max-width: 300px; }
        
        input {
            flex: 1; padding: 12px; border: none;
            border-radius: 20px 0 0 20px; outline: none;
        }

        button {
            padding: 12px 20px; border: none;
            background: #28a745; color: white;
            border-radius: 0 20px 20px 0; cursor: pointer;
        }

        .copy-btn {
            background: #007bff; border-radius: 20px;
            padding: 5px 15px; margin-top: 5px; font-size: 12px;
        }
    </style>
</head>
<body>

    <video id="remote-video" autoplay playsinline></video>
    
    <video id="local-video" autoplay muted playsinline></video>

    <div class="controls">
        <div class="id-box">
            我的 ID: <span id="my-id" style="color: #00ffcc;">加载中...</span><br>
            <button class="copy-btn" onclick="copyId()">复制 ID 发给好友</button>
        </div>

        <div class="input-group">
            <input type="text" id="remote-id" placeholder="粘贴好友的 ID">
            <button onclick="makeCall()">呼叫</button>
        </div>
    </div>

    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script>
        let localStream;
        const peer = new Peer();

        // 1. 自动启动摄像头（手机端会弹出授权）
        async function startMedia() {
            try {
                // 优化手机配置：优先使用前置摄像头
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: "user" }, 
                    audio: true
                });
                localStream = stream;
                document.getElementById('local-video').srcObject = stream;
            } catch (err) {
                alert("无法打开摄像头，请检查 HTTPS 或权限设置");
            }
        }

        // 2. 获取 ID 并显示
        peer.on('open', id => {
            document.getElementById('my-id').innerText = id;
        });

        // 3. 监听并接听电话
        peer.on('call', call => {
            call.answer(localStream);
            call.on('stream', remoteStream => {
                document.getElementById('remote-video').srcObject = remoteStream;
            });
        });

        // 4. 呼叫他人
        function makeCall() {
            const rID = document.getElementById('remote-id').value;
            if (!rID) return alert("请输入对方 ID");
            const call = peer.call(rID, localStream);
            call.on('stream', remoteStream => {
                document.getElementById('remote-video').srcObject = remoteStream;
            });
        }

        // 5. 复制 ID 助手
        function copyId() {
            const id = document.getElementById('my-id').innerText;
            navigator.clipboard.writeText(id);
            alert("ID 已复制，通过微信发给朋友吧！");
        }

        window.onload = startMedia;
    </script>
</body>
</html>
