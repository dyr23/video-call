<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>éš”ç©ºæ§æ ‘ç»ˆæç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; }
        #canvas-ui { position: absolute; top: 10px; right: 10px; width: 100px; height: 130px; border: 2px solid #00ff00; border-radius: 8px; z-index: 100; transform: scaleX(-1); background: #222; }
        #overlay { background: rgba(0,0,0,0.9); transition: opacity 0.5s; }
    </style>
</head>
<body>
    <div id="overlay" class="absolute inset-0 z-[200] flex flex-col items-center justify-center text-white text-center">
        <div class="p-8 border-2 border-green-500 rounded-3xl bg-gray-900 shadow-2xl">
            <h1 class="text-3xl font-bold mb-4">ğŸ–ï¸ éš”ç©ºäº¤äº’ç³»ç»Ÿ</h1>
            <p class="mb-8 text-gray-400 text-lg">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ä»¥æˆæƒ<br>æ‘„åƒå¤´ AI æ•æ‰æ‰‹åŠ¿</p>
            <button onclick="activateAI()" class="bg-red-600 px-12 py-5 rounded-full font-bold text-2xl animate-pulse shadow-lg shadow-red-900/50">
                æˆæƒå¹¶å¯åŠ¨
            </button>
        </div>
    </div>

    <div id="status" class="absolute top-10 w-full text-center text-white z-50 text-xl font-bold"></div>
    <canvas id="canvas-ui"></canvas>
    <video id="input-video" style="display:none"></video>

    <script>
        let scene, camera, renderer, treeGroup, lastX = null;
        const status = document.getElementById('status');

        // 1. åˆå§‹åŒ– 3D åœ£è¯æ ‘
        function init3D() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.set(0, 2.5, 5.5); // æ‹‰è¿‘è§†è§’ï¼Œæ ‘ä¼šå¾ˆå¤§

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            scene.add(new THREE.AmbientLight(0xffffff, 0.8));
            const light = new THREE.PointLight(0xffffff, 1);
            light.position.set(5, 5, 5);
            scene.add(light);

            treeGroup = new THREE.Group();
            treeGroup.scale.set(1.4, 1.4, 1.4); // æ”¾å¤§æ ‘æœ¨

            // æ ‘å¹²
            const trunk = new THREE.Mesh(new THREE.CylinderGeometry(0.2, 0.3, 1), new THREE.MeshPhongMaterial({color: 0x5D4037}));
            treeGroup.add(trunk);
            // åœ£è¯æ ‘å† 
            for(let i=0; i<5; i++) {
                const leaf = new THREE.Mesh(
                    new THREE.ConeGeometry(2.1 - i*0.4, 1.4, 10),
                    new THREE.MeshPhongMaterial({color: 0x1A472A, flatShading: true})
                );
                leaf.position.y = 1.0 + (i * 0.8);
                treeGroup.add(leaf);
            }
            scene.add(treeGroup);
        }

        // 2. æ¿€æ´» AI å¼•æ“
        async function activateAI() {
            document.getElementById('overlay').style.opacity = '0';
            setTimeout(() => document.getElementById('overlay').remove(), 500);
            status.innerText = "æ­£åœ¨å”¤é†’ AI è§†è§‰å¼•æ“...";

            init3D();
            animate();

            const video = document.getElementById('input-video');
            const canvas = document.getElementById('canvas-ui');
            const ctx = canvas.getContext('2d');

            const hands = new Hands({locateFile: (f) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`});
            hands.setOptions({maxNumHands: 1, modelComplexity: 0, minDetectionConfidence: 0.5});

            hands.onResults(res => {
                ctx.clearRect(0,0,canvas.width,canvas.height);
                ctx.drawImage(res.image, 0,0,canvas.width,canvas.height);
                if(res.multiHandLandmarks && res.multiHandLandmarks.length > 0) {
                    status.innerText = "âœ¨ å·²è¿æ¥ï¼è¯·å¤§å¹…åº¦æ‘†åŠ¨æ‰‹æŒ âœ¨";
                    const x = res.multiHandLandmarks[0][8].x; // é£ŸæŒ‡å°– X
                    if(lastX !== null) {
                        // ã€è¶…é«˜çµæ•åº¦ã€‘
                        treeGroup.rotation.y += (x - lastX) * 70; 
                    }
                    lastX = x;
                } else {
                    status.innerText = "ğŸ‘‹ å¾…æœºä¸­...è¯·å±•ç¤ºæ‰‹æŒ";
                    lastX = null;
                }
            });

            const cam = new Camera(video, {
                onFrame: async () => { await hands.send({image: video}); },
                width: 320, height: 240
            });
            await cam.start();
        }

        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        window.onresize = () => {
            if(!camera) return;
            renderer.setSize(window.innerWidth, window.innerHeight);
            camera.aspect = window.innerWidth/window.innerHeight;
            camera.updateProjectionMatrix();
        };
    </script>
</body>
</html>
